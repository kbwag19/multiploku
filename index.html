<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiploku</title>
  <style>
    :root {
      --bg: #0f161d;
      --panel: #16222c;
      --panel-strong: #1d2c38;
      --cell: #22303b;
      --cell-border: #30414e;
      --cell-muted: #152028;
      --accent: #00e0ff;
      --accent-strong: #00c5e0;
      --text: #e7f4ff;
      --muted: #a8c2d6;
      --correct: #2c8f61;
      --incorrect: #b83f4b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 48px 12px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 48px;
      background: var(--accent);
      color: #0a1219;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      font-family: 'Arial Black', sans-serif;
      z-index: 1000;
      box-shadow: 0 2px 10px #00000040;
    }

    .nav-title { font-size: 20px; }

    .nav-buttons .nav-btn {
      background: #0a1219;
      color: var(--accent);
      margin-left: 8px;
      border: 2px solid var(--accent);
      border-radius: 6px;
      padding: 8px 14px;
      font-weight: bold;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .nav-buttons .nav-btn:hover {
      background: var(--accent-strong);
      border-color: var(--accent-strong);
      color: #0a1219;
    }

    .game-wrapper {
      width: 100%;
      max-width: 1180px;
    }

    .board-wrapper {
      background: var(--panel);
      border: 1px solid var(--cell-border);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 12px 30px #00000050;
    }

    .grid-container {
      display: grid;
      grid-template-columns: minmax(360px, 1fr) minmax(320px, 1fr);
      grid-template-rows: auto auto;
      grid-template-areas:
        "puzzle equation"
        "puzzle visual";
      gap: 16px;
      align-items: start;
    }

    #puzzle-container { grid-area: puzzle; display: flex; justify-content: center; }
    #equation-panel { grid-area: equation; display: flex; flex-direction: column; gap: 12px; }
    #visual-container { grid-area: visual; position: relative; min-height: 260px; }

    .container {
      background: var(--panel-strong);
      border: 1px solid var(--cell-border);
      border-radius: 10px;
      padding: 12px;
      box-shadow: inset 0 1px 0 #ffffff10;
    }

    .center-grid {
      width: 100%;
      max-width: 380px;
      aspect-ratio: 1 / 1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 2px;
      padding: 4px;
      background: var(--panel);
      border: 1px solid var(--cell-border);
      border-radius: 6px;
    }

    .cell {
      border: 1px solid var(--cell-border);
      background: var(--cell);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 18px;
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.15s ease;
      position: relative;
    }

    .cell.factor { background: #1b2733; color: #e8f7ff; }
    .cell.null { background: var(--panel); color: var(--muted); }

    .cell input {
      width: 100%;
      height: 100%;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      border: none;
      background: transparent;
      color: #7cf5ff;
      outline: none;
    }

    .cell.hidden { background: var(--cell-muted); color: #7cf5ff; cursor: text; }

    .cell.highlight { box-shadow: 0 0 10px #00ffff55; background: #1c2a35; }
    .cell.active-cell { outline: 2px solid var(--accent); outline-offset: -3px; background: #1a3b49; }
    .cell.factor-selected { outline: 2px solid var(--accent); outline-offset: -3px; background: #1a3b49; }
    .cell.selected { outline: 2px solid var(--accent); outline-offset: -3px; background: #1a3b49; }

    .cell.correct { background: #1f4631 !important; border-color: #2f8159; box-shadow: inset 0 0 10px #2f815980; }
    .cell.incorrect { background: #43202b !important; border-color: #b83f4b; box-shadow: inset 0 0 10px #b83f4b80; }

    .equation-display {
      display: grid;
      grid-template-columns: 1fr auto 1fr auto 1fr;
      gap: 8px;
      align-items: center;
      justify-items: center;
      font-size: 20px;
      color: var(--text);
    }

    .eq-box {
      width: 52px;
      height: 52px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      border: 1px solid var(--cell-border);
      background: var(--cell);
      color: var(--text);
      border-radius: 6px;
      outline: none;
    }

    .eq-box[readonly] { color: var(--muted); }
    .eq-box.editable { color: #7cf5ff; }

    #visual-container {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--panel-strong);
    }

    #rotate-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      color: var(--accent);
      font-size: 22px;
      padding: 4px;
      cursor: pointer;
    }

    #rotate-btn:hover { color: var(--accent-strong); }

    .eq-visual {
      display: grid;
      gap: 6px;
      color: var(--muted);
      font-size: 14px;
      word-break: break-all;
    }

    .eq-visual .object {
      display: inline-block;
      width: clamp(10px, 2.4vw, 18px);
      height: clamp(10px, 2.4vw, 18px);
      border-radius: 50%;
      background: var(--accent);
    }

    .axis-label {
      position: absolute;
      color: var(--muted);
      font-family: 'Arial Black', sans-serif;
      font-size: 14px;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .x-label { bottom: 12px; left: 50%; transform: translateX(-50%); }
    .y-label { left: 12px; top: 50%; transform: translateY(-50%); }
    .axis-label.fading { opacity: 0; }

    .controls {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      background: var(--accent);
      color: #0a1219;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      transition: background 0.2s ease, transform 0.1s ease;
    }

    button:hover { background: var(--accent-strong); }
    button:active { transform: translateY(1px); }
    .button-active { background: #1f4631; color: #e9ffef; }

    .difficulty-container {
      display: flex;
      align-items: center;
      background: var(--panel-strong);
      border: 1px solid var(--cell-border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 8px;
      gap: 8px;
    }

    .difficulty-container input[type=range] { width: 120px; }
    .difficulty-label { font-size: 14px; color: var(--muted); }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-title">MULTIPLOKU</div>
    <div class="nav-buttons">
      <button class="nav-btn">SCORECARD</button>
      <button class="nav-btn">CHALLENGE</button>
    </div>
  </nav>

  <div class="game-wrapper">
    <div class="board-wrapper">
      <div class="grid-container">
        <div class="container" id="puzzle-container">
          <div class="center-grid" id="game-grid"></div>
        </div>
        <div class="container" id="equation-panel">
          <div class="equation-display">
            <input id="eq-left" type="text" class="eq-box"> x
            <input id="eq-right" type="text" class="eq-box"> =
            <input id="eq-result" type="text" class="eq-box">
          </div>
        </div>
        <div class="container" id="visual-container">
          <button id="rotate-btn" title="Rotate dots">&#8635;</button>
          <div id="equation-visual" class="eq-visual" style="display:none;"></div>
          <div id="y-axis-label" class="axis-label y-label"></div>
          <div id="x-axis-label" class="axis-label x-label"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="generateGrid(currentDifficulty)">Start / New Game</button>
    <button id="checkBtn" onclick="toggleValidation()">Check Answers</button>
    <div class="difficulty-container">
      <input type="range" id="difficulty-slider" min="1" max="3" step="1" value="1">
      <span class="difficulty-label" id="difficulty-label">Beginner</span>
    </div>
  </div>

  <script src="math_game_subroutines.js"></script>
  <script src="clickProductCell.js"></script>
</body>
</html>
